<!DOCTYPE html>
<html>

<head>
    <title>Log Search</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <style>
        body {
            background: #f7f7f7;
            padding-top: 30px;
        }

        .results-box {
            max-height: 600px;
            overflow-y: auto;
        }

        .result-item {
            padding: 12px;
            border-bottom: 1px solid #e8e8e8;
        }

        #loading {
            display: none;
            text-align: center;
            font-weight: bold;
            padding: 10px;
            color: #444;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2 class="text-center mb-4">Search Logs</h2>

        <form id="searchForm" class="card shadow-sm p-4 mb-4">

            <!-- Level -->
            <div class="mb-3">
                <label class="form-label fw-bold">Level:</label>
                <div class="row">
                    <div class="col-6 col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="level" value="INFO">
                            <label class="form-check-label">INFO</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="level" value="WARN">
                            <label class="form-check-label">WARN</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="level" value="ERROR">
                            <label class="form-check-label">ERROR</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="level" value="DEBUG">
                            <label class="form-check-label">DEBUG</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Component -->
            <div class="mb-3">
                <label class="form-label fw-bold">Component:</label>
                <div class="row">
                    <div class="col-6 col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="component" value="api-server">
                            <label class="form-check-label">api-server</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="component" value="database">
                            <label class="form-check-label">database</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="component" value="cache">
                            <label class="form-check-label">cache</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="component" value="worker">
                            <label class="form-check-label">worker</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="component" value="auth">
                            <label class="form-check-label">auth</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Host -->
            <div class="mb-3">
                <label class="form-label fw-bold">Host:</label>
                <div class="row">
                    <div class="col-6 col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="host" value="web01">
                            <label class="form-check-label">web01</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="host" value="web02">
                            <label class="form-check-label">web02</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="host" value="cache01">
                            <label class="form-check-label">cache01</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="host" value="worker01">
                            <label class="form-check-label">worker01</label>
                        </div>
                    </div>

                    <div class="col-6 col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="host" value="db01">
                            <label class="form-check-label">db01</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Request ID -->
            <div class="mb-3">
                <label class="form-label fw-bold">Request ID:</label>
                <input type="text" class="form-control" name="request_id" placeholder="Enter Request ID">
            </div>

            <!-- Timestamp -->
            <div class="mb-3">
                <label class="form-label fw-bold">Timestamp:</label>
                <input type="text" class="form-control" name="timestamp" placeholder=">2025-11-17 10:00:00">
            </div>

            <!-- Submit button -->
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-danger px-4 py-2">Search</button>
            </div>
        </form>

        <!-- LOADING -->
        <div id="loading">Loading results...</div>

        <!-- ERROR -->
        <div id="errorBox"></div>

        <!-- RESULTS -->
        <div id="resultBox" class="card shadow-sm p-3 results-box"></div>

    </div>

    <script>
        $(document).ready(function () {

            $("#form").submit(function (event) {
                event.preventDefault();   // stop full page submit

                $("#loading").show();
                $("#errorBox").html("");
                $("#resultBox").html("");

                $.ajax({
                    url: "/search",
                    method: "POST",
                    data: $(this).serialize(),
                    headers: { "X-Requested-With": "XMLHttpRequest" },

                    success: function (response) {
                        $("#loading").hide();

                        let html = "";

                        if (response.entries.length === 0) {
                            $("#resultBox").html("<p class='text-center text-muted'>No results found.</p>");
                            return;
                        }

                        response.entries.forEach(function (item) {
                            html += `
                        <div class="result-item">
                            <strong>Time:</strong> ${item.TimeStamp} <br>
                            <strong>Level:</strong> ${item.Level.Level} <br>
                            <strong>Component:</strong> ${item.Component.Component} <br>
                            <strong>Host:</strong> ${item.Host.Host} <br>
                            <strong>RequestID:</strong> ${item.RequestId} <br>
                            <strong>Message:</strong> ${item.Message}
                        </div>
                    `;
                        });

                        $("#resultBox").html(html);
                    },

                    error: function (xhr) {
                        $("#loading").hide();
                        $("#errorBox").html(
                            `<div class="alert alert-danger text-center">${xhr.responseJSON.error}</div>`
                        );
                    }
                });
            });

        });
    </script>
</body>

</html>